<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Stitching Images by KKyang</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Stitching Images</h1>
      <h2 class="project-tagline">NTU VFX Project 2</h2>
      <a href="https://github.com/KKyang/IMGSTCHHW2" class="btn">View on GitHub</a>
      <a href="https://github.com/KKyang/IMGSTCHHW2/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/KKyang/IMGSTCHHW2/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="台灣大學-數位視覺效果-project-2-stitching-images" class="anchor" href="#%E5%8F%B0%E7%81%A3%E5%A4%A7%E5%AD%B8-%E6%95%B8%E4%BD%8D%E8%A6%96%E8%A6%BA%E6%95%88%E6%9E%9C-project-2-stitching-images" aria-hidden="true"><span class="octicon octicon-link"></span></a>台灣大學 數位視覺效果 Project 2 Stitching Images</h2>

<p><strong>R03631012</strong> 黃揚文 <strong>R03631014</strong> 徐嘉君</p>

<h3>
<a id="使用相機" class="anchor" href="#%E4%BD%BF%E7%94%A8%E7%9B%B8%E6%A9%9F" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用相機</h3>

<p>本專題使用的相機為Nikon D3200，鏡頭為kit鏡 (AF-S NIKKOR 18-55mm 1:3.5-5.6G)</p>

<h3>
<a id="開發環境" class="anchor" href="#%E9%96%8B%E7%99%BC%E7%92%B0%E5%A2%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>開發環境</h3>

<ol>
<li>Visual Studio 2013 Pro</li>
<li>Qt 5.4</li>
<li>OpenCV 2.4.9</li>
</ol>

<h3>
<a id="實作方法" class="anchor" href="#%E5%AF%A6%E4%BD%9C%E6%96%B9%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>實作方法</h3>

<h4>
<a id="sift特徵點" class="anchor" href="#sift%E7%89%B9%E5%BE%B5%E9%BB%9E" aria-hidden="true"><span class="octicon octicon-link"></span></a>SIFT特徵點</h4>

<p>本專題利用上課講義提到的SIFT演算法尋找每個影像的特徵點，並參考Lowe的論文逐步實現計算過程。數學方面的運算則是直接使用OpenCV提供的<code>cv::gemm</code> 解方程式解。</p>

<h4>
<a id="focal-length估算" class="anchor" href="#focal-length%E4%BC%B0%E7%AE%97" aria-hidden="true"><span class="octicon octicon-link"></span></a>focal length估算</h4>

<p>因為從exif讀出的資訊為原始照片尺寸下的focal length，且單位為mm。之前在撰寫程式時曾經因為改變圖片大小而導致在像素下的focal length值一同改變，因此我們直接將focal length資訊利用OpenCV的focal length estimation，以數張SIFT特徵點去推出該大小下的focal length。</p>

<h4>
<a id="特徵點匹配" class="anchor" href="#%E7%89%B9%E5%BE%B5%E9%BB%9E%E5%8C%B9%E9%85%8D" aria-hidden="true"><span class="octicon octicon-link"></span></a>特徵點匹配</h4>

<p>本專題原本是想直接使用Flann裡面的kdtree來尋找兩個descriptor之間的關係。但是由於跟OpenCV中的Flann函式衝突，因此我們先將我們自己的descriptor格式轉成OpenCV的格式後，再將配對點算出。</p>

<p>算出後的點，利用最小distance的兩倍作為閥值，將過度歪斜的匹配點予以刪除，得到最後的良好配對點。</p>

<p><img src="http://i.imgur.com/W6XJco8.png" alt="Imgur"></p>

<h4>
<a id="image-warping" class="anchor" href="#image-warping" aria-hidden="true"><span class="octicon octicon-link"></span></a>Image Warping</h4>

<h2>
<a id="參考講義的warping採用講義的cylindrical-warping的公式全景拍攝方式為相機架在腳架上轉一圈進行拍攝warping使用focal-length-做計算得到該影像投影在圓柱上應該在的相對位置以方便做影像接合除了warping整張圖片先前取得的sift特徵點也要進行warping已得到warping後該特徵點的正確位置" class="anchor" href="#%E5%8F%83%E8%80%83%E8%AC%9B%E7%BE%A9%E7%9A%84warping%E6%8E%A1%E7%94%A8%E8%AC%9B%E7%BE%A9%E7%9A%84cylindrical-warping%E7%9A%84%E5%85%AC%E5%BC%8F%E5%85%A8%E6%99%AF%E6%8B%8D%E6%94%9D%E6%96%B9%E5%BC%8F%E7%82%BA%E7%9B%B8%E6%A9%9F%E6%9E%B6%E5%9C%A8%E8%85%B3%E6%9E%B6%E4%B8%8A%E8%BD%89%E4%B8%80%E5%9C%88%E9%80%B2%E8%A1%8C%E6%8B%8D%E6%94%9Dwarping%E4%BD%BF%E7%94%A8focal-length-%E5%81%9A%E8%A8%88%E7%AE%97%E5%BE%97%E5%88%B0%E8%A9%B2%E5%BD%B1%E5%83%8F%E6%8A%95%E5%BD%B1%E5%9C%A8%E5%9C%93%E6%9F%B1%E4%B8%8A%E6%87%89%E8%A9%B2%E5%9C%A8%E7%9A%84%E7%9B%B8%E5%B0%8D%E4%BD%8D%E7%BD%AE%E4%BB%A5%E6%96%B9%E4%BE%BF%E5%81%9A%E5%BD%B1%E5%83%8F%E6%8E%A5%E5%90%88%E9%99%A4%E4%BA%86warping%E6%95%B4%E5%BC%B5%E5%9C%96%E7%89%87%E5%85%88%E5%89%8D%E5%8F%96%E5%BE%97%E7%9A%84sift%E7%89%B9%E5%BE%B5%E9%BB%9E%E4%B9%9F%E8%A6%81%E9%80%B2%E8%A1%8Cwarping%E5%B7%B2%E5%BE%97%E5%88%B0warping%E5%BE%8C%E8%A9%B2%E7%89%B9%E5%BE%B5%E9%BB%9E%E7%9A%84%E6%AD%A3%E7%A2%BA%E4%BD%8D%E7%BD%AE" aria-hidden="true"><span class="octicon octicon-link"></span></a>參考講義的warping採用講義的Cylindrical warping的公式，全景拍攝方式為相機架在腳架上轉一圈進行拍攝，warping使用Focal Length 做計算，得到該影像投影在圓柱上應該在的相對位置，以方便做影像接合。除了warping整張圖片，先前取得的SIFT特徵點也要進行warping，已得到warping後該特徵點的正確位置。</h2>

<h2>
<a id="----" class="anchor" href="#----" aria-hidden="true"><span class="octicon octicon-link"></span></a>| <img src="http://i.imgur.com/6dwRsyY.jpg" alt="Imgur"> | <img src="http://i.imgur.com/554Zczc.jpg" alt="Imgur"> |</h2>

<h4>
<a id="multiresolution-spline-blending" class="anchor" href="#multiresolution-spline-blending" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiresolution spline blending</h4>

<p>本專題參考Multiresolution spline blending演算法來消除圖與圖之間連接時因色調不同而造成的違和感。首先將兩張耀接合的重疊區塊取出並製作這兩張圖的高斯金字塔，再利用高斯金字塔製作出拉普拉斯金字塔，拉普拉斯金字塔最小的為圖片的色彩資訊，而其他層為邊界的資訊，我們將色彩資訊做橫向的高斯加權，重疊中線以50%作為基準，如下圖所示。邊界的資訊則是直接以中線左右各取一半的資訊，最後再將拉普拉斯金字塔還原成合成影像並將兩張圖片重疊的區域替換掉。</p>

<p><img src="http://i.imgur.com/mkizo9y.png" alt="Imgur"></p>

<h4>
<a id="結果" class="anchor" href="#%E7%B5%90%E6%9E%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>結果</h4>

<p><img src="http://i.imgur.com/7kSGgOd.png" alt="Imgur"></p>

<p><img src="http://i.imgur.com/ghHTmoT.png" alt="Imgur"></p>

<p><strong>原始檔案</strong></p>

<p>1</p>

<table>
<thead>
<tr>
<th><img src="http://i.imgur.com/6dwRsyY.jpg" alt="Imgur"></th>
<th><img src="http://i.imgur.com/vMTNYnu.jpg" alt="Imgur"></th>
<th><img src="http://i.imgur.com/0X7AUnE.jpg" alt="Imgur"></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="http://i.imgur.com/hN4Laze.jpg" alt="Imgur"></td>
<td><img src="http://i.imgur.com/cQrm7Ui.jpg" alt="Imgur"></td>
<td><img src="http://i.imgur.com/Pwy2QUc.jpg" alt="Imgur"></td>
</tr>
</tbody>
</table>

<p>2</p>

<table>
<thead>
<tr>
<th><img src="http://i.imgur.com/Y4FRCHU.jpg" alt="Imgur"></th>
<th><img src="http://i.imgur.com/hBwQXTr.jpg" alt="Imgur"></th>
<th><img src="http://i.imgur.com/JHpeWVz.jpg" alt="Imgur"></th>
<th><img src="http://i.imgur.com/oVGpk7l.jpg" alt="Imgur"></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="http://i.imgur.com/QM63a5z.jpg" alt="Imgur"></td>
<td><img src="http://i.imgur.com/TLD68UJ.jpg" alt="Imgur"></td>
<td><img src="http://i.imgur.com/Voa2keN.jpg" alt="Imgur"></td>
<td></td>
</tr>
</tbody>
</table>

<h3>
<a id="作者" class="anchor" href="#%E4%BD%9C%E8%80%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>作者</h3>

<p>黃揚文 (<a href="https://github.com/KKyang" class="user-mention">@KKyang</a>)
徐嘉君 (<a href="https://github.com/Chia-ChunHsu" class="user-mention">@Chia-ChunHsu</a>)</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>可以利用Github提供的issues功能提供我們意見，謝謝!</p>

<h3>
<a id="reference" class="anchor" href="#reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference</h3>

<ol>
<li>課程講義</li>
<li>David G. Lowe, Distinctive Image Features from Scale-Invariant Keypoints. Computer Science Department of University of British Columbia. (2004)</li>
<li>Peter J. BURT, Edward H. ADELSON, A Multiresolution Spline With Application to Image Mosaics. ACM Transactions on Grphics, Vol. 2. No. 4, 1983: 217-236</li>
</ol>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/KKyang/IMGSTCHHW2">Stitching Images</a> is maintained by <a href="https://github.com/KKyang">KKyang</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

